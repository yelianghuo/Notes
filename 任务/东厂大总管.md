日常遗留任务
===============


1.  cti目标：aim_rate_01、aim_rate_24
    数据获取方式：
    52.55.78.75: /home/mobdev/workspace/deengine/conf/user.conf.YYYYmmddHH，使用campaign对应network_cid查找。
                     network_cid                                                                             aim cti
    510352      Myntra3_in     mobvista_adn  mob5a88c94ce0848ccf   {"1": 0.1, "24": 0.9}
    510352      Myntra3_in     mobvista_adn  mob67934f214b206145 {"1": 0.1, "24": 0.9}
    联系人：李斌
     
     
     
2.  是否可以进行掐量：
    数据获取方式： get http://172.31.22.120:3000/template?cid=$campaign_id，返回code == 200 && template != null 代表可以掐量，否则不可以。
    返回样例   {"code":500,"msg":"cannot get 3s uuid"}
                    {"code":200,"template":[{"subids":["adgroup","rejected_install_callback"],"weight":100}]}
                    {"code":200,"template":null}
    联系人：李斌
    curl "http://172.31.22.120:3500/template?cid=152056409"
    
方案：
   （1）
    
    * 拷贝文件到目的主机scp -i key user.conf.2017062017 172.31.28.176:/tmp/
    * 根据network_cid，campagin_id来唯一确定01、24的值
    * 获取前一天当前时间的前一个小时: file=user.conf.$(date -d "-1 days -1 hours" +%Y%m%d%H )
    
    
   （2）
        
        
    * curl "http://172.31.22.120:3000/template?cid=14965313"
    * 在smartclick里面增加是够可以掐量对的字段 ：alter table 表名 add 列名 列数据类型 [after 插入位置];
        alter table m_campagin_daily_report add canbe_cut tinyint(1) default '0';
    * python里面写http get服务，根据code和template来填充新添加的字段
    
# 2016/06/27
  mode.txt->mode_cut_subdis.txt之间的优化
  * 在template_http中将node.txt中，将campaign_id放在set里面去从，因为不同的type会对应重复的campaign_id
  
  * 修改crontab fvta_daily_report中数据更新时间在早上6点15
  * 增加bin.li讨论组里面提的新需求
  * 修改aim_cti的值 ，乘以10000
  * 
  
## 数据库优化：

    * 由于cti_data.detect_main表中campaign_id是varchar（255）,因此在查询的时候用''字符串去查找会比使用m_campaign_daily_report中的int（11）<-->cid查找会快10倍
    * 加上limit 1，会稍微优化点性能，因为此处为了添加third和hops是用campaign_id直接对应查询该数据是否存在，limit 1可以在一定程度上限制扫面全表
      select campaign_id, third, hops from cti_data.detect_main where campaign_id = '151547155' limit 1;
    
    
    * template_puller 模块中，对于mode不同位的数据准备用thread来并行处理
        --->cut、subids
        --->deviceId
        
    # sendmail 自动报告err_log
    
    
  20170703
  ------
    http中.cache文件中小文件过多
    解决方法：定期清理.cache文件
    
    
  20170707
  ---------
  * 修改m_campaign_daily_report中cti相关字段的类型
  * 测试当前程序能否正常往es和mysql导入数据
  
  
  20170711
  --------
  * 生产者消费者模型
  * 学习markdown中表格 链接 图片
  * go实现http服务器
  * 适配器模式
  * MongDB
  * Redis
  
  
  20170713
  ------
  * kafka模块重写
  * 翻译kafka模块
  * 为什么会产生kafka这个模块，分析原因
  * 将kafka写成支持with语句对象，在__enter__()中connect，在__exit__()中close
  * 回去将expressvpn安装好
  
  
  
20170716
------------
  * 把自己的电脑装成ubuntu
  
  
20170721
-------
  * 学习sql正则匹配
 
 
20170725
---
  * 运用select可以让channe变成非阻塞改写cherry
  * 学习chan实现原理
  * 无缓冲的chan为什么在select中写入数据时，不读，则不执行？？ https://gobyexample.com/non-blocking-channel-operations
  为什么直接往无缓冲的chan中写数据，直接报错死锁
  * seelog 测试rollingfile
  * dust== levelgo
  * go参数解析 kingpin包
  
  * innodb 
  * 看mysql的pattern match： https://dev.mysql.com/doc/refman/5.7/en/retrieving-data.html
   
  * go 中time包的time.after() time.tick() time.format()结合select,在简书上面写文章
  
  * go seelog包也可以写篇文章